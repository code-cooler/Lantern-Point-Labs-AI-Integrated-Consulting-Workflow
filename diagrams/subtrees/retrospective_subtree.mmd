flowchart TD
    %% Retrospective & Knowledge Capture Subtree
    
    %% Main node connecting back to main diagram
    mainFlow(["Back to Main Flow"]) -.-> retrospective[Retrospective &\nKnowledge Capture]
    
    %% Detailed steps within Retrospective phase (limited to ~5 nodes)
    retrospective --> lessonsLearned[Lessons Learned Session]
    lessonsLearned --> projectDocumentation[Project Documentation]
    projectDocumentation --> knowledgeBase[Knowledge Base Update]
    
    %% AI Integration - Knowledge Management
    knowledgeBase --> aiKnowledgeManager{AI Knowledge Management}
    aiKnowledgeManager --> patternExtraction[AI: Pattern Extraction Across Projects]
    patternExtraction --> knowledgeDistillation[AI: Knowledge Distillation]
    
    %% Return to main flow
    knowledgeDistillation --> projectEnd(["Project End"])
    
    %% Click interactions
    click mainFlow "../index.html" "Return to main workflow"
    click projectEnd ""../index.html" "Return to main workflow"
    click aiKnowledgeManager "#" "AI Knowledge Management\n\nPurpose: Extract patterns across projects and distill knowledge for future engagements\n\nPrompt example: 'Compare the outcomes of this project with our previous work in [industry]. What patterns emerge regarding successful approaches, and how might we codify these into our methodology?'\n\nClick for more details" _self
    
    %% Detailed Styling and Classifications
    classDef phase fill:#f5f5f5,stroke:#333,stroke-width:1px;
    classDef subProcess fill:#fff8e1,stroke:#ff8f00,stroke-width:1px;
    classDef aiDecision fill:#ede7f6,stroke:#4527a0,stroke-width:1px,stroke-dasharray: 5 2;
    classDef aiNode fill:#f3e5f5,stroke:#6a1b9a,stroke-width:1px,stroke-dasharray: 5 2;
    classDef navigation fill:#e8f5e9,stroke:#2e7d32,stroke-width:1px,stroke-dasharray: 3 3;
    
    %% Apply styles to nodes
    class retrospective phase;
    class lessonsLearned,projectDocumentation,knowledgeBase subProcess;
    class aiKnowledgeManager aiDecision;
    class patternExtraction,knowledgeDistillation aiNode;
    class mainFlow,projectEnd navigation;
